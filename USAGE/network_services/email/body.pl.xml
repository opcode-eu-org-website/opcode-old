<article>
<title>Poczta</title>

<p>Przy konfiguracji poczty warto zwrócić uwagę na możliwość zapewnienia jej filtrowania, przechowywanie jej w katalogach użytkowników oraz umieszczanie nagłówka informującego o adresie koperty - w przypadku exima jest to dość proste do uzyskania, zwłaszcza to ostatnie, które jest robione automnatycznie. Do filtrowania można wykorzystywać np. "procmail". Może on wraz z skanerami clamscan, spamassassin posłuzyć do stworzenia systemu antywirusowego i antyspamowego (przykładowy plik konfiguracyjny <id_link id="wirus_check">filtra antywirusowego</id_link>). Rozważyć należy również dodanie w głównym pliku ustawień poziomu logowania: <code>VERBOSE=no</code> i pliku logów <code>LOGFILE=/var/log/procmail.log</code>. Należy jednak zwrócić uwagę na to iż filtry uczące się zaczynają działać dopiero po przeanalizowaniu 200 pozytywnych i 200 negatywnych przykładów ... (prezentowany skrypt uczy tylko negatywów), ustawienia te można zmienić w pliku konfiguracyjnym (więcej na jego temat w <doc url="http://spamassassin.apache.org/full/3.0.x/dist/doc/Mail_SpamAssassin_Conf.html">SpamAssassin - konfiguracja</doc>). Niekiedy (gdy filtr uczący się jest bardzo sprawny warto zwiększyć jego punktację (więcej o ustawianiu punktacji w <doc url="http://spamassassin.apache.org/tests.html">SpamAssassin - testy</doc>).</p>

<p>Zamieszczam też dość bogato komentowany przykładowy <id_link id="exim4.conf">plik konfiguracyjny exim'a</id_link>, implementujący virusertable (<a class="int" href="./virtusertable">przykład</a> pliku z zdefiniowanymi standardowymi aliasami), obsługę procmaila (poprzez <id_link id="procmail.sh">skrypt</id_link> zapewniający poprawne logowanie do sysloga oraz obsługę <id_link id="procmail.rc">globalnego pliku rc</id_link>), dovecot'owych plików sieve, plików .forward, systemu vacation oraz tworzenie kopii odbieranej poczty po stronie serwera (dla poprawnego działania tego systemu należy zapewnić automatyczne kasowanie starych kopii - poprzez dodanie do cron'a odpowiedniego <id_link id="rotate_mail_backup.sh">skryptu</id_link>), a także ssl i autoryzację oraz graylisty (w oparciu o greylistd) i skanowanie antywirusowe i antyspamowe na etapie kopertowym. Dodatkowo polecam zmienić w <kbd class="path">/etc/greylistd/config</kbd> czasy retryMin i retryMax na odpowiednio: 60 i 86400 (minuta i 24 godziny) oraz ustawić odpowiednią whitelistę (<kbd class="path">/etc/greylistd/whitelist-hosts</kbd>) systemów mających problem z przejściem przez greylist lub po prostu godnych zaufania (<a class="int" href="./whitelist-hosts">przykład</a>). Aby nasz system lepiej pokonywał greylisty na innych serwerach warto w <kbd class="path">/etc/default/exim4</kbd> ustawić <code>QUEUEINTERVAL='3m'</code>.</p>

<p>Zamieszcam także <a class="int" href="exim4-spy.conf">zmodyfikowaną</a> wersję tego pliku - służy ona do wysyłania kopii wychodzącej poczty na zadany adres i korzysta z zewnętrznego serwera SMTP wymagającego autoryzacji. Konfiguracja exima pozwala na odrzucanie wiadomości z informacją o nowym adresie (błąd SMTP 551 User not local), poprzez umieszczenie w pliku aliasów wpisu <code>::fail: 551 User not local; please try &lt;inny@example.org&gt;</code> niestety w przeciwieństwie do tego czego można by się spodziewać serwery pocztowe (w tym exim) nie rozróżniają tego od zwykłego błędu 550 i nie próbują przekazać poczty na wskazany adres, za to zwracają do adresata.</p>

<p>Przyjęte przeze mnie rozwiązanie z obsługą <wiki en="Sieve (mail filtering language)">sieve</wiki> ustawianego "zdalnie" (z wykorzystaniem jakiegoś klienta obsługującego ten mechanizm - np. squirrelmail z wtyczką avelsieve) polega na realizacji obsługi przez dovecot'a który w przypadku wykrycia takiego pliku (i braku plików o wyższym priorytecie) pełni funkcję LDA. Możliwe jest też korzystanie z filtrów sieve w samym eximie poprzez umieszczenie plików forward z odpowiednią pierwszą linią i zawartością będącą filtrem sieve.</p>

<p>Ważne jest zapewnienie dostępu do poczty przechowywanej na serwerze - służą do tego protokoły POP i IMAP. Polecam serwer dovecot, przy jego konfiguracji warto zwrócić uwagę na uruchomienie SSL (nieszyfrowany dostęp z zewnątrz można zabronić poprzez zamknięcie portów nieszyfrowanych, a zostawienie szyfrowanych na firewallu i ustawieniu <code>protocols = imap imaps pop3 pop3s</code> w konfiguracji dovecot) a także na ustawienie nasłuchiwania na ipv6 <code>listen = [::]</code> (oczywiście nasłuchuje wtedy także po IPv4). Zmaieszczam także przykładowy plik konfiguracyjny dla tego serwera - <id_link id="dovecot-local.conf">dovecot-locla.conf</id_link>.</p>

<p>Dla poprawnego działania powyższych rozwiązań użytkownik Debian-exim powinien należeć do grup greylist i (w zależności od ustawień systemu) shadow, użytkownik dovecot do grup: mail i (w zależności od ustawień systemu) shadow, natomiast użytkownik clamav do grupy Debian-exim.</p>

<p>Popularnym i istotnym elementem systemów pocztowych jest bramka umożliwiająca dostęp do poczty poprzez WWW - np. <homepage url="http://www.squirrelmail.org/">Squirrel Mail</homepage>. W systemie tym dla poprawnego kodowania wiadomości istotne jest posiadanie zainstalowanych odpowiednich locale. Większość takich systemów posiada dość rozbudowane opcje (konfiguracja tożsamości, książki adresowej, wersje robocze, ...), które mogą być powiększone przy pomocy dodatkowych modułów/patch'y. W przypadku wspomnianego już Squirrel Mail takie dodatki znaleźć możemy na <homepage>http://www.squirrelmail.org/plugins.php</homepage>, na szczególną uwagę zasługują: <homepage url="http://www.squirrelmail.org/plugin_view.php?id=55">View As HTML</homepage> (jest nawet w paczce deb), <homepage url="http://www.squirrelmail.org/plugin_view.php?id=73">Avelsieve - Sieve Mail Filters</homepage> (jest nawet w paczce deb), <homepage url="http://www.squirrelmail.org/plugin_view.php?id=256">Advanced Settings</homepage> (np. wyświetlanie folderów specjalnych na początku, domyślne używanie priorytetów wiadomości), <homepage url="http://www.squirrelmail.org/plugin_view.php?id=54">S/MIME verification</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=186">Show Headers</homepage>; a także: <homepage url="http://www.squirrelmail.org/plugin_view.php?id=120">File Manager</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=239">Calendar File Backend</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=79">Notes</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=174">To-Do Reminder</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=112">NNTP webinterface</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=93">Bookmarks</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=8">Quick Save</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=32">Autocomplete</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=195">Custom From</homepage>, <homepage url="http://www.squirrelmail.org/plugin_view.php?id=91">Message Flags &amp; Icons</homepage>.</p>

<p>Aby konsolowy klient <homepage url="http://www.courier-mta.org/cone/">cone</homepage> mógł łączyć się po SSL z serwerami mającymi błędny (np. samopodpisany) certyfikat w polu określającym adres serwera po jego nazwie lub numerze ip należy dodać: <code>/novalidate-cert</code></p>
</article>
