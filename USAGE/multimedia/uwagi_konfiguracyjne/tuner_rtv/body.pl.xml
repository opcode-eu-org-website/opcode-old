<article>
<title>Tuner radiowo-telewizyjny i cyfrowa rejestracja wideo</title>
<p>Uruchomienie karty telewizyjnej wymaga zapoznania się z listą obsługiwanych kart i tunerów, odnalezienia na niej posiadanej pozycji bądź pozycji zbliżonej a następnie załadowaniu odpowiedniego modułu z odpowiednimi parametrami. W moim wypadku (karta PV-BT878P+ rev.2F z tunerem TPI8PSB02P) słuszne okazało się <code>modprobe bttv card=138 tuner=28 pll=1 radio=1</code>. Następnie możemy przystąpić do konfiguracji programu do odbioru telewizji / radia (np. xawtv, fbtv); przykładowy plik z konfiguracją dla AsterCity (nazwy niektórych kanałów mogą być nieaktualne) - <a class="int" href="./xawtv">.xawtv</a> (jeżeli istnieje /etc/xawtv radzę zarchiwizować i skasować). Przy karcie graficznej nvidii spotkałem się z problemem polegającym na niewyświetlaniu obrazu przez xawtv - rozwiązaniem okazało się <code>xawtv -noxv</code> (aby ustalić ten parametr jako domyślny należy do pliku ~/.Xdefaults dodać "xawtv.xv: no").<!--drugim problemem było radio bez głosu (karta wymagała włączenia głosu na urządzeniu /dev/video a nie /dev/radio) - rozwiązaniem okazało się /usr/bin/radio -q -c /dev/radio0 -f 107.1; /usr/bin/radio -c /dev/video0</p>
<p>Wydaje mi się iż w nowszych jądrach (np. 2.6.16) jest błąd polegający na tym iż moduł tuner ignoruje otrzymywany od bttv paramert określający typ, objawia ię to wpisywaniem do logów jądra (dmesg) komunikatu "tuner type not set" pomimo ustawionego typu tuner. Prowizorycznym rozwiązaniem jakie zastosowałem jest pobranie źródeł jądra, przeedytowanie pliku "drivers/media/video/tuner-core.c" (w funkcji "tuner_attach" zastępujemy <code>t->type = UNSET;</code> przez <code>t->type = NUMER_TYPU_NASZEGO_TUNERA</code>) oraz zbudowanie tego modułu - <code>make drivers/media/video/tuner.ko</code>.--></p>

<p>Do nagrywania cyfrowego wideo polecam program "transcode" (niestety nie ma go w oficjalnym Debianie) z następującymi parametrami <code>transcode -i /dev/video0 -p /dev/dsp0 -g 768x576 -b 64 -e 16000,16,1 -o "$1" -x v4l -y xvid4 -R 1 -avi_limit 2048</code> (rejestruje to obraz w najlepszej  możliwej w PALu jakości). Wcześniej przy pomocy ulubionego programu nastawiamy żądaną stację, przy poprawnej pracy dysku i nie oglądaniu zwartości katalogu w którym są zapisywane pliki nie powinno gubić klatek.</p>
<p>Niekiedy na nagraniach w maksymalnej rozdzielczości PAL pojawia się problem przekłamanych linii (wynika to z emisji w PALu jednej klatki obrazu w postaci dwóch półklatek wyświetlanych jako jednej) warto wtedy w VLC z menu Stettings wybrać Prefernces - General settings - Obraz i ustawić Video filter module na "Deinterlacing video filter" (następnie zrestartować vlc).</p>

<p>Wspomniany już VLC umożliwia także przechwytywanie i wysyłanie w sieć IP sygnału audio-wideo z naszej karty TV (oraz z pewnym wspomaganiem (program radio służący do nastrojenia odbiornika) także sygnału audio z tunera radiowego). Warto pamiętać że kanał możemy zmieniać zewnętrznie (już po odpaleniu vlc) przy pomocy v4lctrl z pakietu xawtv. Wersja 1.0 VLC ma pewne problemy z obsługą niektórych urządzeń V4L, objawia się to błędem "v4l demux error: chroma selection failed" (dla v4l) lub "v4l2 demux error: cannot get video input characteristics" (dla v4l2). Rozwiązaniem (przynajmniej dla kart na bttv) okazuje się być dodanie parametru <code>chroma_agc=1</code> do modułu jądra.</p>

<p>VLC może również posłużyć do odbioru sygnału telewizji cyfrowej (DVB). Konieczne do tego jest oczywiście załadowanie stosownych modułów z odpowiednimi opcjami (dla testowanej karty "Medion" było to: <code>modprobe saa7134 i2c_scan=1 card=12 tuner=30; sleep 2; modprobe saa7134_alsa</code>). Potem wystarczy <code>vlc dvb:// --dvb-frequency=<var>690000000</var> --dvb-budget-mode</code>, gdzie <var>690000000</var> jest częstotliwością multipleksu który chcemy odbierać, <code>dvb-budget-mode</code> powoduje odbieranie przez VLC całego strumienia (całego multiplexu, zawierającego zwykle kilka kanałów) i tym samym umożliwa jego rejestrację. Do DVB przydany może być także programik <code>dvbtune</code> (w szczególności <code>dvbtune -i -f <var>690000000</var></code> wyświetli informacje o kanałach na podanym multiplexie, a <code>dvbtune -m -f <var>690000000</var></code> umożliwia monitorowanie sygnału)</p>

<p>Niekiedy można spotkać się z problemem polegającym na braku sprzętowego sprzężenia wejścia liniowego z wyjściem głośnikowym - problem ten może rozwiązać program kopiujący wejście na wyjście karty dźwiękowej <id_link id="alsa_copy.c">(wersja alsa)</id_link>, <id_link id="dsp.c">(wersja oss)</id_link> oraz <id_link id="tv.vlc.sh">skrypt dla KDE</id_link> uruchamiający cały zestaw aplikacji do słuchania radia / oglądania telewizji. Podobnym zagadnieniem jest obsługa kart transmitujących audio tylko po PCI - należy wtedy przekierować dźwięk z urządzenia dźwiękowego związanego z kartą RTV na główną kartę dźwiękową - <code>arecord -D hw:2,0 -r 32000 -c 2 -f S16_LE | aplay - &amp; xawtv -c /dev/video1 -vbidev /dev/vbi1 &amp;&amp; killall arecord</code></p>

<p>Jako że składnia opisywanych programów do rejestracji i transmisji sieciowej sygnału multimedialnego nie koniecznie jest łatwa i przyjemna to zachęca do zapoznania się z moim projektem <id_link id="rtv_recorder_and_transmiter">skrypu ułatwiającego te operacje</id_link>. Na koniec warto wspomnieć także o programie <homepage url="http://www.goron.de/~froese/">alevt</homepage>, który umożliwia softwerowe dekodowanie teletextu (telegazety) z karty obsługiwanej przez bttv: <code>alevt -vbi /dev/vbi0 -charset latin-2</code>.</p>
</article>
